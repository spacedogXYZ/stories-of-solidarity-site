"use strict";window.Solidarity=_.extend(window.Solidarity,{Models:{},Collections:{},Views:{},Routers:{},init:function(){console.log("Stories of Solidarity"),new Solidarity.Routers.Auth({}),new Solidarity.Routers.Pages({}),new Solidarity.Routers.Stories({}),Backbone.history.start(),$.ajaxSetup({headers:{"X-Requested-With":"XMLHttpRequest"}})}}),window.urlParam=function(a){var b=window.location.href.match(/^[^#]+#([^?]*)\??(.*)/),c=(b[1],b[2]),d=c.split(a+"=")[1];return void 0!==d?decodeURIComponent(d.split("&")[0]):null},$(document).ready(function(){Solidarity.init()}),this.JST=this.JST||{},this.JST["app/scripts/templates/about.ejs"]=function(){{var a="";_.escape}return a+='<section class="jumbotron">\n    <h1 style="border-bottom:1px solid #ccc;padding-bottom:17px;font-weight:300;font-size:20px;letter-spacing:4px;color:#CCCCCC;font-family:\'bignoodle\';">STORIES OF SOLIDARITY</h1>\n\n    <h2 class="sans-serif">A social media platform that encourages workers in the low-wage, precarious workforce to build new forms of solidarity.</h2>\n</section>\n\n<section class="jumbotron" style="background-color: #e5ae5b;">\n    <h2 class="sans-serif">What is <span style="font-family:\'bignoodle\';font-weight:normal;letter-spacing:2px;font-size: 40px;">STORIES OF SOLIDARITY</span>?</h2>\n    <iframe src="//player.vimeo.com/video/75254033?title=0&amp;byline=0" width="800" height="450" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>\n</section>\n\n<section class="jumbotron" style="background: #bcbcbc;">\n    <h2 class="sans-serif">How does it work?</h1>\n    <div style="width:450px;margin-bottom:30px;border-left:2px dotted #666;padding-left:10px;">\n        Post a story via the web, mobile app, or text messaging. It will appear on the map, creating a visualization of narratives. Totally anonymous.\n    </div>\n    <div style="text-align:center;"><img src="images/9e09adb4.howitworks.png" width="100%" style="max-width:750px;"></div>        \n</section>\n'},this.JST["app/scripts/templates/authLogin.ejs"]=function(){{var a,b="";_.escape}return b+='<div class="auth login container-fluid">\n\n<div class="alert alert-info alert-dismissable">\n    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n    Never registered? <a href="#auth/register">Create a new user</a><br />\n    Forgot your password? <a href="#auth/password/reset">Reset it</a>\n</div>\n\n<h2>Log In User</h2>\n\n<form class="form-horizontal" id="login" action="'+(null==(a=Solidarity.apiRoot)?"":a)+'auth/login/" method="POST">\n    <div class="form-group">\n        <label for="username" class="col-sm-2 control-label">Username:</label>\n        <input name="username" class="col-sm-4" />\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <label for="password" class="col-sm-2 control-label">Password:</label>\n        <input name="password" class="col-sm-4" type="password"/>\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <button class="btn btn-primary col-sm-offset-2" type="submit">\n            <span class="glyphicon glyphicon-log-in"></span> Go\n        </button>\n    </div>\n</form>\n\n</div>'},this.JST["app/scripts/templates/authPasswordChange.ejs"]=function(){{var a,b="";_.escape}return b+='<div class="auth passwordChange container-fluid">\n\n<h2>Change Password</h2>\n\n<form class="form-horizontal" id="passwordChange" action="'+(null==(a=Solidarity.apiRoot)?"":a)+'auth/password/change/" method="POST">\n\n    <div class="form-group">\n        <label for="new_password1" class="col-sm-2 control-label">New Password:</label>\n        <input name="new_password1" class="col-sm-4" type="password"/>\n        <span class="help-block"></span>\n    </div>\n\n    <div class="form-group">\n        <label for="new_password2" class="col-sm-2 control-label">Confirm New Password:</label>\n        <input name="new_password2" class="col-sm-4" type="password"/>\n        <span class="help-block"></span>\n    </div>\n\n    <div class="form-group">\n        <button class="btn btn-primary col-sm-offset-2" type="submit">\n            <span class="glyphicon glyphicon-log-in"></span> Go\n        </button>\n    </div>\n</form>\n\n</div>'},this.JST["app/scripts/templates/authPasswordReset.ejs"]=function(){{var a,b="";_.escape}return b+='<div class="auth passwordReset container-fluid">\n\n<h2>Reset Password</h2>\n\n<form class="form-horizontal" id="passwordReset" action="'+(null==(a=Solidarity.apiRoot)?"":a)+'auth/password/reset/" method="POST">\n\n    <div class="form-group">\n        <label for="email" class="col-sm-2 control-label">Registered Email:</label>\n        <input name="email" class="col-sm-4" type="email"/>\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <button class="btn btn-primary col-sm-offset-2" type="submit">\n            <span class="glyphicon glyphicon-log-in"></span> Go\n        </button>\n    </div>\n</form>\n\n</div>'},this.JST["app/scripts/templates/authPasswordResetConfirm.ejs"]=function(){{var a,b="";_.escape}return b+='<div class="auth passwordChange container-fluid">\n\n<h2>Set New Password</h2>\n\n<form class="form-horizontal" id="passwordResetConfirm" action="'+(null==(a=Solidarity.apiRoot)?"":a)+'auth/password/reset/confirm/" method="POST">\n\n    <div class="form-group">\n        <label for="new_password1" class="col-sm-2 control-label">New Password:</label>\n        <input name="new_password1" class="col-sm-4" type="password"/>\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <label for="new_password2" class="col-sm-2 control-label">Confirm New Password:</label>\n        <input name="new_password2" class="col-sm-4" type="password"/>\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <button class="btn btn-primary col-sm-offset-2" type="submit">\n            <span class="glyphicon glyphicon-log-in"></span> Go\n        </button>\n    </div>\n</form>\n\n</div>'},this.JST["app/scripts/templates/authRegister.ejs"]=function(){{var a,b="";_.escape}return b+='<div class="auth register container-fluid">\n\n<div class="alert alert-info alert-dismissable">\n    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n    Already registered? <a href="#auth/login">Login</a>\n</div>\n\n<h2>Register New User</h2>\n\n<form class="form-horizontal" id="register" action="'+(null==(a=Solidarity.apiRoot)?"":a)+'auth/registration/" method="POST">\n    <div class="form-group">\n        <label for="username" class="col-sm-2 control-label">Username:</label>\n        <input name="username" class="col-sm-4" />\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <label for="password1" class="col-sm-2 control-label">Password:</label>\n        <input name="password1" class="col-sm-4" type="password"/>\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <label for="password2" class="col-sm-2 control-label">Confirm Password:</label>\n        <input name="password2" class="col-sm-4" type="password"/>\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <button class="btn btn-primary col-sm-offset-2" type="submit">\n            <span class="glyphicon glyphicon-log-in"></span> Go\n        </button>\n    </div>\n</form>\n\n</div>'},this.JST["app/scripts/templates/authUserDetails.ejs"]=function(){{var a,b="";_.escape}return b+='<div class="auth user container-fluid">\n\n<h2>User Update</h2>\n\n<form class="form-horizontal" id="userDetails" action="'+(null==(a=Solidarity.apiRoot)?"":a)+'auth/user/" method="POST">\n    <div class="form-group">\n        <label for="email" class="col-sm-2 control-label">Email:</label>\n        <input name="email" class="col-sm-4" />\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <label for="first_name" class="col-sm-2 control-label">First Name:</label>\n        <input name="first_name" class="col-sm-4" />\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <label for="last_name" class="col-sm-2 control-label">Last Name:</label>\n        <input name="last_name" class="col-sm-4" />\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <label for="phone" class="col-sm-2 control-label">SMS Number:</label>\n        <input name="phone" class="col-sm-4" />\n        <span class="help-block col-sm-4"></span>\n    </div>\n\n    <div class="form-group">\n        <button class="btn btn-primary col-sm-offset-2" type="submit">\n            <span class="glyphicon glyphicon-log-in"></span> Go\n        </button>\n    </div>\n</form>\n\n</div>'},this.JST["app/scripts/templates/copyright.ejs"]=function(){{var a="";_.escape}return a+='<div class="container">\n<h1>Copyright</h1>\n\n<p>Submitted content is provided under the Creative Commons license, which gives you the ability to share and adapt the material under the same license. Any re-use of the content must follow the following conditions:\n<ul>\n    <li>You must attribute the content to StoriesOfSolidarity.org. On the web, this means a link. For use offline, please use the text “Content (cc) StoriesOfSolidarity.org”</li>\n    <li>You cannot use our content for commercial purposes.</li>\n    <li>If you use our content, you must share what you create with it under the same license. This is called share-alike, and it\'s the basis of the free culture movement.</li>\n    <li>You may not redistribute photographs or reuse the StoriesOfSolidarity name and design without specific permission.</li>\n</ul>\n\n<p>You can find the full legal text of the license at <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/legalcode">creativecommons.org/licenses/by-nc-sa/3.0/legalcode</a>\n\n<h2>Open Source</h2>\n<p>The code that powers this website, database and mobile application are open source, and available on <a href="https://github.com/spacedogXYZ/stories-of-solidarity-site">GitHub</a> under the <a href="http://opensource.org/licenses/GPL-3.0"></a>GPL license. We welcome new feature ideas, issue reports, and pull requests.</p>\n\n<p>Specific functionality is provided by the <a href="http://d3js.org">D3</a> visualization library, <a href="https://www.djangoproject.com">Django</a> <a href="http://www.django-rest-framework.org">REST-Framework</a>, the <a href="https://www.twilio.com"></a>Twilio telephony service, and <a href="www.openstreetmap.org"></a>Open Street Map</a>. </p>\n</div>'},this.JST["app/scripts/templates/formError.ejs"]=function(a){{var b,c="";_.escape}return c+='<div class="alert alert-warning" role="alert">\n  <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>\n  <span class="sr-only">Error:</span>\n  '+(null==(b=a.non_field_errors)?"":b)+"\n</div>"},this.JST["app/scripts/templates/index.ejs"]=function(){{var a="";_.escape}return a+='<div id="splash"></div>\n\n<div id="intro"></div>'},this.JST["app/scripts/templates/intro.ejs"]=function(){{var a="";_.escape}return a+='<div class="modal fade" id="introModal">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n                <h4 class="modal-title">Work in Progress</h4>\n            </div>\n            <div class="modal-body">\n                <p>Stories of Solidarity is a work in progress.</p>\n                <p>Please feel free to browse and leave us feedback at: </p>\n                <p><a href="mailto:storiesofsolidarity@gmail.com">storiesofsolidarity@gmail.com</a></p>\n                <p>Thank you!</p>\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n            </div>\n        </div>\n    </div>\n</div>'},this.JST["app/scripts/templates/privacy.ejs"]=function(){{var a="";_.escape}return a+='<div class="container">\n<h1>Privacy Policy</h1>\n\n<p>StoriesOfSolidarity takes seriously workers need for anonymity when speaking out, and our system is designed to protect your information to the best of our ability.</p>\n\n<h3>Submitted Information</h3>\n<p>If you register an account with us, we secure your login and password in our database with well-tested encryption methods <a href="https://docs.djangoproject.com/en/1.8/topics/auth/passwords/">[1]</a>. StoriesOfSolidarity staff and organizers may have access to any information you provided on account registration, including first and last name, occupation, employer, location (city, state, county or zipcode), and photograph.</p>\n\n<p>If you feel uncomfortable with revealing your real identity when sharing a story, please create an account using a pseudonym and sign up with a new email address that you do not share with other services.</p>\n\n<h3>Information Gathered</h3>\n<p>We log certain technical information as part of the normal operation of this site and may send it to third-parties for data analysis and service provision. These parties are covered by their own privacy policies.</p>\n    <ul>\n        <li><a href="https://www.cloudflare.com/security-policy">CloudFlare</a> may receive your full IP address, or other potentially identifiable browser characteristics</li>\n        <li><a href="http://www.google.com/policies/privacy/">Google Analytics</a> may receive your anonymized IP address</li>\n        <li><a href="https://www.twilio.com/legal/privacy">Twilio</a> may receive your phone number if you send us a text message</li>\n        <li><a href="https://www.heroku.com/policy/privacy">Heroku</a> or <a href="https://sendgrid.com/privacy">SendGrid</a> may receive your email address if you register for an account with us</li>\n    </ul>\n\n<h3>Required Disclosure</h3>\n\n<p>We may disclose personally identifiable information about you to third parties in limited circumstances, including: (1) with your consent; or (2) when we have a good faith belief it is required by law, such as pursuant to a subpoena or other judicial or administrative order.</p>\n\n<p>If we are required by law to disclose the information that you have submitted, we will attempt to provide you with prior notice (unless we are prohibited or it would be futile) that a request for your information has been made in order to give you an opportunity to object to the disclosure. We will attempt to provide this notice by email, if you have given us an email address, or by postal mail if you have entered a postal address. If you do not challenge the disclosure request, we may be legally required to turn over your information.</p>\n\n<h4>Acknowledgements</h4>\n\n<em>Portions of this policy provided by the <a href="https://www.eff.org/policy"></a>Electronic Frontier Foundation, under a Creative Commons Attribution license</em>\n\n</div>'},this.JST["app/scripts/templates/splash.ejs"]=function(){{var a="";_.escape}return a+='<div class="quote col-md-4">\n    <h1></h1>\n\n    <button class="btn btn-square" id="enter" href="#map">Enter</button>\n</div>\n'},this.JST["app/scripts/templates/story.ejs"]=function(a){{var b,c="",d=_.escape;Array.prototype.join}return c+='<div class="storyRead">\n    <h1>',c+=a.author&&a.author.anonymous!==!0?'\n            <a href="#read/author/'+d(a.author.user.id)+'">'+d(a.author.user.first_name)+" "+d(a.author.user.last_name)+"</a>\n        ":"\n            Anonymous\n        ",c+="\n        ",a.author&&a.author.occupation&&(c+="\n            "+d(a.author.occupation)+" \n            ",a.author.employer&&(c+=" at "),c+="\n        "),c+="\n        ",a.author&&a.author.employer&&(c+=" "+d(a.author.employer)+" "),c+="\n        ",a.location&&a.location.city&&a.location.state&&(c+="\n            from "+d(a.location.city)+", "+d(a.location.state)+"\n        "),c+="\n    </h1>\n    <h2>"+(null==(b=new Date(a.updated_at).toDateString())?"":b)+'</h2>\n\n    <div class="body">\n        '+d(a.content)+"\n    </div>\n    \n    ",void 0==a.posted&&(c+='<a href="#back" onclick="history.go(-1);return false;" >&larr; Back</a>'),c+="\n</div>"},this.JST["app/scripts/templates/storyList.ejs"]=function(a){{var b,c="";_.escape,Array.prototype.join}return a.filtered&&(c+="\n<h1>Stories from "+(null==(b=a.city)?"":b)+", "+(null==(b=a.state)?"":b)+"</h1>\n"),c+='\n<div class="storyList">\n    <!-- story items added here -->\n    \n    <div class="item more" style="display:none;">\n        <h2><a class="loadMore" href="#read">+ More</a></h2>\n    </div>\n</div>\n\n<div class="backLink">\n    <a href="#back" onclick="history.go(-1);return false;" >&larr; Back</a>\n</div>'},this.JST["app/scripts/templates/storyListItem.ejs"]=function(a){{var b,c="",d=_.escape;Array.prototype.join}return c+='<div class="item story" id="story-'+(null==(b=a.id)?"":b)+'">\n    <div class="body">\n        ',c+=a.content.length>160?"\n            "+d(a.content.slice(0,160))+"...\n        ":"\n            "+d(a.content)+"\n        ",c+='\n        <span class="readMore">\n            <a class="readMore" href="#read/story/'+(null==(b=a.id)?"":b)+'">+ read more</a>\n        </span>\n    </div>\n    <h3>'+(null==(b=new Date(a.updated_at).toDateString())?"":b)+"<br>\n        by ",c+=a.author&&a.author.user?'\n            <a href="#read/author/'+d(a.author.user.id)+'">'+d(a.author.user.first_name)+" "+d(a.author.user.last_name)+"</a>\n        ":"\n            Anonymous\n        ",c+="\n        </h3>\n</div>"},this.JST["app/scripts/templates/storyListNoResults.ejs"]=function(){{var a="";_.escape}return a+='<div class="item" style="">\n    <h2>None Yet</h2>\n    <a href="#share">+ Share Yours</a>\n</div>'},this.JST["app/scripts/templates/storyMap.ejs"]=function(){{var a="";_.escape}return a+='<div id="map" class="storyMap"></div>'},this.JST["app/scripts/templates/storyPost.ejs"]=function(){{var a,b="";_.escape,Array.prototype.join}return b+='<div class="storyPost container">\n<h2>Share Your Story</h2>\n<div class="row">\n    <div class="col-md-4">\n        Post \n        ',b+=void 0!==Solidarity.user?'\n        as <a href="#auth/user">'+(null==(a=Soldarity.user)?"":a)+'</a>\n        or <a href="#auth/logout">Logout</a>.\n        ':'\n        anonymously or <a href="#auth/login?success=share" >Login</a>.\n        ',b+='\n        <br> Only fields marked <span class="required">*</span> are required.\n    </div>\n</div>\n\n<form class="form-horizontal" action="'+(null==(a=Solidarity.apiRoot)?"":a)+'story/" id="storyPost" method="POST">\n    <fieldset>\n        <div class="form-group">\n            <label for="name" class="col-md-1">Name:</label>\n            <input id="name" class="col-xs-12 col-md-6" name="name" value="" type="text">\n        </div>\n\n        <div class="form-group">\n            <label for="occupation" class="col-md-1">Occupation:</label>\n            <input id="occupation" class="col-xs-12 col-md-6" name="occupation" value="" type="text">\n        </div>\n\n        <div class="form-group">\n            <label for="employer" class="col-md-1">Employer:</label>\n            <input id="employer" class="col-xs-12 col-md-6" name="employer" value="" type="text">\n        </div>\n\n        <div class="form-group">\n            <label for="content" class="col-md-1">Story: <span class="required">*</span></label>\n            <textarea id="content" class="col-xs-12 col-md-10" rows="6" name="content" value="" required="required"></textarea>\n        </div>\n\n        <div class="form-group">\n            <label for="location" class="col-md-1">Location:</label>\n            <div class="input-group col-xs-12 col-md-6">\n                <input id="city" class="col-xs-12" name="location.city" value="" type="text" placeholder="City">\n                <select id="state" class="selectpicker dropup" name="location.state" >\n                    <option value="">- State -</option>\n                    <option value="AL">Alabama</option>\n                    <option value="AK">Alaska</option>\n                    <option value="AS">American Samoa</option>\n                    <option value="AZ">Arizona</option>\n                    <option value="AR">Arkansas</option>\n                    <option value="CA">California</option>\n                    <option value="CO">Colorado</option>\n                    <option value="CT">Connecticut</option>\n                    <option value="DE">Delaware</option>\n                    <option value="DC">District of Columbia</option>\n                    <option value="FL">Florida</option>\n                    <option value="GA">Georgia</option>\n                    <option value="GU">Guam</option>\n                    <option value="HI">Hawaii</option>\n                    <option value="ID">Idaho</option>\n                    <option value="IL">Illinois</option>\n                    <option value="IN">Indiana</option>\n                    <option value="IA">Iowa</option>\n                    <option value="KS">Kansas</option>\n                    <option value="KY">Kentucky</option>\n                    <option value="LA">Louisiana</option>\n                    <option value="ME">Maine</option>\n                    <option value="MD">Maryland</option>\n                    <option value="MA">Massachusetts</option>\n                    <option value="MI">Michigan</option>\n                    <option value="MN">Minnesota</option>\n                    <option value="MS">Mississippi</option>\n                    <option value="MO">Missouri</option>\n                    <option value="MT">Montana</option>\n                    <option value="NE">Nebraska</option>\n                    <option value="NV">Nevada</option>\n                    <option value="NH">New Hampshire</option>\n                    <option value="NJ">New Jersey</option>\n                    <option value="NM">New Mexico</option>\n                    <option value="NY">New York</option>\n                    <option value="NC">North Carolina</option>\n                    <option value="ND">North Dakota</option>\n                    <option value="MP">Northern Mariana Islands</option>\n                    <option value="OH">Ohio</option>\n                    <option value="OK">Oklahoma</option>\n                    <option value="OR">Oregon</option>\n                    <option value="PA">Pennsylvania</option>\n                    <option value="PR">Puerto Rico</option>\n                    <option value="RI">Rhode Island</option>\n                    <option value="SC">South Carolina</option>\n                    <option value="SD">South Dakota</option>\n                    <option value="TN">Tennessee</option>\n                    <option value="TX">Texas</option>\n                    <option value="UT">Utah</option>\n                    <option value="VT">Vermont</option>\n                    <option value="VI">Virgin Islands</option>\n                    <option value="VA">Virginia</option>\n                    <option value="WA">Washington</option>\n                    <option value="WV">West Virginia</option>\n                    <option value="WI">Wisconsin</option>\n                    <option value="WY">Wyoming</option>\n                </select>\n                <div class="input-group-btn">\n                    <button type="button" class="btn btn-sm line-height-1" id="geolocate"><i class="glyphicon glyphicon-screenshot"></i></button>\n                </div>\n            </div>\n        </div>\n\n        <div class="form-group hidden">\n            <label for="photo" class="col-md-1">Photo:</label>\n            <input type="file" class="col-md-6 filestyle" name="photo" />\n        </div>\n\n        <div class="form-group">\n            <label class="col-md-1"></label>\n            <div class="input-group col-xs-12 col-md-6">\n                <button type="submit" class="btn btn-primary">Post!</button>\n            </div>\n        </div>\n    </fieldset>\n</form>\n\n</div>'},Solidarity.Models=Solidarity.Models||{},function(){Solidarity.Models.BaseModel=Backbone.Model.extend({initialize:function(){},defaults:{},validate:function(){},parse:function(a){return a},url:function(){var a=this.get("links"),b=a&&a.self;return b||(b=Backbone.Model.prototype.url.call(this)),b},sync:function(a,b,c){var d=_.isFunction(b.url)?b.url():b.url;return d+="/"===d.charAt(d.length-1)?"":"/",c=_.extend(c,{url:d}),Backbone.sync(a,b,c)}})}(),Solidarity.Models=Solidarity.Models||{},function(){Solidarity.Models.Story=Solidarity.Models.BaseModel.extend({urlRoot:Solidarity.apiRoot+"story/"})}(),Solidarity.Models=Solidarity.Models||{},function(){Solidarity.Models.Author=Solidarity.Models.BaseModel.extend({url:Solidarity.apiRoot+"author/",idAttributemodel:"username"})}(),Solidarity.Models=Solidarity.Models||{},function(){Solidarity.Models.Location=Solidarity.Models.BaseModel.extend({urlRoot:Solidarity.apiRoot+"location/"})}(),Solidarity.Collections=Solidarity.Collections||{},function(){Solidarity.Collections.BaseCollection=Backbone.PageableCollection.extend({resultsField:"results",totalRecordsField:"count",nextField:"next",previousField:"previous",queryParams:{totalPages:null,totalRecords:null,pageSize:null},state:{pageSize:25},parseRecords:function(a){return a&&_.has(a,this.resultsField)&&_.isArray(a[this.resultsField])?a[this.resultsField]:void Backbone.PageableCollection.prototype.parseRecords.apply(this,arguments)},parseState:function(a){return{totalRecords:a[this.totalRecordsField]}},parseLinks:function(a){return{prev:a[this.previousField],next:a[this.nextField],first:null}}})}(),Solidarity.Collections=Solidarity.Collections||{},function(){Solidarity.Collections.Stories=Solidarity.Collections.BaseCollection.extend({model:Solidarity.Models.Story,url:Solidarity.apiRoot+"story/"})}(),Solidarity.Collections=Solidarity.Collections||{},function(){Solidarity.Collections.Authors=Solidarity.Collections.BaseCollection.extend({model:Solidarity.Models.Author})}(),Solidarity.Collections=Solidarity.Collections||{},function(){Solidarity.Collections.Locations=Solidarity.Collections.BaseCollection.extend({model:Solidarity.Models.Location,url:Solidarity.apiRoot+"location/"})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.BaseView=Backbone.View.extend({assign:function(a,b){a.setElement(this.$(b)).render()},initialize:function(){this.render()},render:function(){return this.$el.html(this.template()),this}}),Solidarity.Views.FormView=Solidarity.Views.BaseView.extend({events:{submit:"submit","keyup input.has-error":"clearFieldErrors"},templateError:JST["app/scripts/templates/formError.ejs"],render:function(){return this.$el.html(this.template()),this.$form=$(this.form),this},clearFieldErrors:function(a){var b=this,c=$(a.target).attr("name");$(b.form+' label[for="'+c+'"]').removeClass("has-error"),$(b.form+' input[name="'+c+'"]').removeClass("has-error"),$(b.form+' input[name="'+c+'"] + .help-block').html("")},clearAlerts:function(){$(this.form+" .alert").remove()},submit:function(a){a.preventDefault();var b=this;return $.ajax({type:b.$form.attr("method"),url:b.$form.attr("action"),data:b.$form.serializeArray(),success:function(a){return $(b.form+" .alert").remove(),void 0!==b.onSuccess?b.onSuccess(a):!0},error:function(a){b.clearAlerts(),b.$form.addClass("error");var c=a.responseJSON;return void 0===c?(b.$form.append(b.templateError({non_field_errors:a.statusText})),console.log(a.responseText),!0):(_.map(c,function(a,c){$(b.form+' label[for="'+c+'"]').addClass("has-error"),$(b.form+' input[name="'+c+'"]').addClass("has-error"),$(b.form+' input[name="'+c+'"] + .help-block').html(a)}),void 0!==c.non_field_errors&&b.$form.append(b.templateError(c)),!1)}}),!1},redirect:function(){window.urlParam("redirect")?Backbone.history.navigate(window.urlParam("success"),{trigger:!0}):Backbone.history.navigate("",{trigger:!0})}})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.Story=Solidarity.Views.BaseView.extend({template:JST["app/scripts/templates/story.ejs"],el:"#content",events:{},initialize:function(){var a=this;this.listenTo(this.model,"add",this.render),this.model.fetch({success:$.proxy(a.render,a)})},render:function(){this.model&&this.model.attributes&&this.$el.html(this.template(this.model.toJSON()))}})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.StoryList=Solidarity.Views.BaseView.extend({template:JST["app/scripts/templates/storyList.ejs"],templateItem:JST["app/scripts/templates/storyListItem.ejs"],templateNoResults:JST["app/scripts/templates/storyListNoResults.ejs"],el:"#content",events:{"click a.loadMore":"loadMore"},initialize:function(a){this.options=a,this.render(),this.collection=new Solidarity.Collections.Stories({mode:"infinite"}),this.listenTo(this.collection,"add",this.addStory),this.filterData(),this.getFirstPage()},filterData:function(){},getFirstPage:function(){var a=this;this.collection.getFirstPage({success:function(b){0===b.length&&$(a.templateNoResults({})).insertBefore(".storyList .item.more"),a.collection.hasNextPage()&&$(".item.more").show(),window.location.href.indexOf("?story=")>0&&a.scrollTo(Solidarity.urlParam("story"))}})},addStory:function(a){a.attributes.content&&$(this.templateItem(a.attributes)).insertBefore(".storyList .item.more"),this.collection.hasNextPage()||$(".item.more").hide()},render:function(){this.$el.html(this.template({}))},loadMore:function(){this.collection.getNextPage()},scrollTo:function(a){var b=$("#story-"+a);b.length>0&&$("html, body").scrollTop(b.offset().top)}}),Solidarity.Views.StoryListLocation=Solidarity.Views.StoryList.extend({filterData:function(){this.collection.queryParams=_.extend(this.collection.queryParams,{city:this.options.city,state:this.options.state})},render:function(){this.$el.html(this.template({filtered:!0,city:this.options.city,state:this.options.state}))}})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.StoryMap=Solidarity.Views.BaseView.extend({template:JST["app/scripts/templates/storyMap.ejs"],el:"#content",events:{},initialize:function(){this.collection=new Solidarity.Collections.Locations({})},getData:function(){var a=this;this.collection.fetch({success:function(){a.renderStories(),a.listenTo(a.collection,"add change",a.renderStories)}})},drawMap:function(){function a(a,c){k.map.selectAll("path").data(topojson.feature(c,c.objects.states).features).enter().append("path").attr("d",j).attr("class","feature").on("click",b),k.map.append("path").datum(topojson.mesh(c,c.objects.states,function(a,b){return a!==b})).attr("class","mesh").attr("d",j)}function b(a){if(h.node()===this)return c();h.classed("active",!1),h=d3.select(this).classed("active",!0);var b=.9;"25"===a.id&&(b=.75),"36"===a.id&&(b=.6),"09"===a.id&&(b=.5),"44"===a.id&&(b=.3),"11"===a.id&&(b=.2);var d=j.bounds(a),e=d[1][0]-d[0][0],l=d[1][1]-d[0][1],m=(d[0][0]+d[1][0])/2,n=(d[0][1]+d[1][1])/2,o=b/Math.max(e/f,l/g),p=[f/2-o*m,g/2-o*n];k.svg.transition().duration(750).call(i.translate(p).scale(o).event)}function c(){h.classed("active",!1),h=d3.select(null),k.svg.transition().duration(750).call(i.translate([0,0]).scale(1).event)}function d(){k.map.style("stroke-width",1.5/d3.event.scale+"px"),k.map.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}function e(){d3.event.defaultPrevented&&d3.event.stopPropagation()}var f=960,g=500,h=d3.select(null);this.projection=d3.geo.albersUsaPr().scale(1e3).translate([f/2,g/2]);var i=d3.behavior.zoom().translate([0,0]).scale(1).scaleExtent([1,8]).on("zoom",d),j=d3.geo.path().projection(this.projection);

this.svg=d3.select("#map").append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+f+" "+g).classed("svg-content-responsive",!0).on("click",e,!0),this.svg.append("rect").attr("class","background").attr("width",f).attr("height",g).on("click",c),this.map=this.svg.append("g");var k=this;this.svg.call(i.event),void 0===this.us_json?d3.json(Solidarity.siteRoot+"scripts/map/us.json",function(b,c){k.us_json=c,a(b,k.us_json)}):a(null,this.us_json)},render:function(){this.$el.html(this.template()),this.drawMap()},renderStories:function(){var a=this.projection,b=d3.scale.log();b.domain([1,100]).range([.5,0]);var c=d3.tip().html(function(a){var b='<%= story_count %> stor<%= story_count > 1 ? "ies" : "y"%> in <%= city %>, <%= state %>';return _.template(b)(a.attributes)});this.map.call(c),this.map.append("g").attr("class","bubble").selectAll("circle").data(this.collection.models).enter().append("circle").attr("r",function(){return 5}).attr("transform",function(b){var c=a([b.attributes.lon,b.attributes.lat]);return"translate("+c+")"}).style("opacity",function(a){return b(a.attributes.story_count)}).on("mouseover",c.show).on("mouseout",c.hide).on("click",function(a){c.hide(),Backbone.history.navigate("/list/"+a.attributes.state.toLowerCase()+"/"+a.attributes.city.toLowerCase(),{trigger:!0})})}})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.StoryPost=Solidarity.Views.FormView.extend({template:JST["app/scripts/templates/storyPost.ejs"],el:"#content",form:"form#storyPost",events:{"click button#geolocate":"geolocate"},initialize:function(){_.extend(this.events,Solidarity.Views.FormView.prototype.events),this.render()},render:function(){return this.$el.html(this.template()),this.$form=$(this.form),$(".filestyle").filestyle({input:!1,buttonText:"Upload",size:"sm",iconName:"glyphicon-cloud-upload"}),$(".selectpicker").selectpicker(),this},onSuccess:function(a){console.log("storyPosted",a);var b="read/story/"+a.id+"?posted=true";Backbone.history.navigate(b,{trigger:!0})},geolocate:function(){return Modernizr.geolocation?(console.log("geolocate!"),void navigator.geolocation.getCurrentPosition(this.locationToCityState,this.geoError.bind(this))):this.geoError({code:0,message:"Your browser does not support geolocation."})},geoError:function(a){this.clearAlerts();var b="Geolocation error";1===a.code&&(b="Please allow the browser to access your location."),2===a.code&&(b="Geolocation position unavailable."),3===a.code&&(b="Geolocation position timeout."),this.$form.append(this.templateError({non_field_errors:b}))},locationToCityState:function(a){var b=this;$.ajax("http://nominatim.openstreetmap.org/reverse?format=json",{type:"GET",data:{lat:a.coords.latitude,lon:a.coords.longitude},success:function(a){$("input#city").val(a.address.city);var b=$("select#state option").filter(function(b,c){return $(c).text()===a.address.state}).val();$("#state.selectpicker").selectpicker("val",b),$("button#geolocate").attr("disabled","disabled")},error:function(a,c,d){return b.geoError({code:4,message:d})}})}})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.AuthLogin=Solidarity.Views.FormView.extend({form:"form#login",template:JST["app/scripts/templates/authLogin.ejs"],onSuccess:function(a){return a.key&&$.cookie("token",a.key),this.redirect()}}),Solidarity.Views.AuthRegister=Solidarity.Views.FormView.extend({form:"form#register",template:JST["app/scripts/templates/authRegister.ejs"]}),Solidarity.Views.AuthPasswordChange=Solidarity.Views.FormView.extend({form:"form#passwordChange",template:JST["app/scripts/templates/authPasswordChange.ejs"]}),Solidarity.Views.AuthPasswordReset=Solidarity.Views.FormView.extend({form:"form#passwordReset",template:JST["app/scripts/templates/authPasswordReset.ejs"]}),Solidarity.Views.AuthPasswordResetConfirm=Solidarity.Views.FormView.extend({form:"form#passwordResetConfirm",template:JST["app/scripts/templates/authPasswordResetConfirm.ejs"]}),Solidarity.Views.AuthUserDetails=Solidarity.Views.FormView.extend({form:"form#userDetails",template:JST["app/scripts/templates/authUserDetails.ejs"]})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.Page=Solidarity.Views.BaseView.extend({el:"#content",initialize:function(a){this.template=JST[a],this.render()},render:function(){return this.$el.html(this.template()),this}})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.Intro=Solidarity.Views.BaseView.extend({template:JST["app/scripts/templates/intro.ejs"],events:{},initialize:function(){this.render(),$("#introModal").modal("true"===$.cookie("hideModal")?"hide":"show"),$("#introModal").on("hidden.bs.modal",function(){$.cookie("hideModal","true")})}})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.Splash=Solidarity.Views.BaseView.extend({template:JST["app/scripts/templates/splash.ejs"],el:"#splash",events:{"click button#enter":"enter"},languages:["en","es","tl","zh"],currentLanguageID:0,buttonText:{en:"Enter",es:"Entrar",tl:"Pumasok",zh:"进入"},languageInterval:1e4,fadeInterval:2e3,initialize:function(){this.render();var a=this;$.ajax("/scripts/splash/featuredStories.json",{type:"GET",dataType:"json",success:function(b){a.splashStories=b,a.loadRandomStory()},error:function(a,b,c){console.log("error",b,c)}})},loadRandomStory:function(){if(void 0===this.splashStories)return this.enter();var a=_.random(0,this.splashStories.length-1);this.story=this.splashStories[a],this.$el.css("background-image","url("+this.story.image+")");var b=this.$el.find(".quote");b.find("h1").text(this.story.quote.en),b.addClass(this.story.align),setInterval(this.nextLanguage.bind(this),this.languageInterval)},nextLanguage:function(){var a=this.currentLanguageID+1;a>=this.languages.length&&(a=0);var b=this.languages[a];this.currentLanguageID=a;var c=this.$el.find(".quote"),d=this.$el.find("h1, button");d.fadeOut(this.fadeInterval);var e=function(){c.find("h1").text(this.story.quote[b]),c.find("button").text(this.buttonText[b]),d.fadeIn(this.fadeInterval)};setTimeout(e.bind(this),this.fadeInterval)},enter:function(){Solidarity.language=this.languages[this.currentLanguageID],Backbone.history.navigate("#map",{trigger:!0})}})}(),Solidarity.Views=Solidarity.Views||{},function(){Solidarity.Views.Index=Solidarity.Views.BaseView.extend({template:JST["app/scripts/templates/index.ejs"],el:"#content",events:{},initialize:function(){this.render(),this.splashView=new Solidarity.Views.Splash({el:"#splash"}),this.introView=new Solidarity.Views.Intro({el:"#intro"})},render:function(){this.$el.html(this.template())}})}(),Solidarity.Routers=Solidarity.Routers||{},function(){Solidarity.Routers.Base=Backbone.Router.extend({options:{trailingSlashIsSignificant:!0},initialize:function(){this.bind("route",this.pageView)},pageView:function(){var a=Backbone.history.getFragment();if(/^\//.test(a)||""===a||(a="/"+a),"undefined"!=typeof window._gaq&&_gaq.push(["_trackPageview",a]),"undefined"!=typeof window.GoogleAnalyticsObject){var b=window.GoogleAnalyticsObject;window[b]("send","pageview",a)}}})}(),Solidarity.Routers=Solidarity.Routers||{},function(){Solidarity.Routers.Auth=Solidarity.Routers.Base.extend({routes:{"auth/register":"register","auth/login":"login","auth/logout":"logout","auth/password/change":"passwordChange","auth/password/reset":"passwordReset","auth/password/reset/confirm":"passwordResetConfirm","auth/user":"userDetails"},register:function(){new Solidarity.Views.AuthRegister({el:"#content"})},login:function(){new Solidarity.Views.AuthLogin({el:"#content"})},logout:function(){new Solidarity.Views.AuthLogout({el:"#content"})},passwordChange:function(){new Solidarity.Views.AuthPasswordChange({el:"#content"})},passwordReset:function(){new Solidarity.Views.AuthPasswordReset({el:"#content"})},passwordResetConfirm:function(){new Solidarity.Views.AuthPasswordResetConfirm({el:"#content"})},userDetails:function(){new Solidarity.Views.AuthUserDetails({el:"#content"})}})}(),Solidarity.Routers=Solidarity.Routers||{},function(){Solidarity.Routers.Pages=Solidarity.Routers.Base.extend({routes:{"":"index",about:"about",privacy:"privacy",copyright:"copyright",admin:"adminRedirect"},index:function(){new Solidarity.Views.Index({})},about:function(){new Solidarity.Views.Page("app/scripts/templates/about.ejs")},privacy:function(){new Solidarity.Views.Page("app/scripts/templates/privacy.ejs")},copyright:function(){new Solidarity.Views.Page("app/scripts/templates/copyright.ejs")},adminRedirect:function(){window.location.href="https://stories-of-solidarity.herokuapp.com/admin/"}})}(),Solidarity.Routers=Solidarity.Routers||{},function(){Solidarity.Routers.Stories=Solidarity.Routers.Base.extend({routes:{map:"storyMap",read:"storyList","read/story/:id":"storyView","list/:state/:city":"storyListLocation",share:"storyPost"},cached:{storyMap:void 0},storyMap:function(){this.cached.storyMap=this.cached.storyMap||new Solidarity.Views.StoryMap,this.cached.storyMap.render(),this.cached.storyMap.getData()},storyList:function(){new Solidarity.Views.StoryList},storyListLocation:function(a,b){new Solidarity.Views.StoryListLocation({state:a,city:b})},storyView:function(a){new Solidarity.Views.Story({model:new Solidarity.Models.Story({id:a})})},storyPost:function(){new Solidarity.Views.StoryPost}})}();